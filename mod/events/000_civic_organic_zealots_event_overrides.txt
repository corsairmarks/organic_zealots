namespace = anomaly
namespace = utopia

# Modified: add "no AI" tech option tech_flash_learning
ship_event = {
	id = anomaly.6705
	title = anomaly.6705.name
	desc = {
		trigger = {
			text = anomaly.6705.desc.start
			text = newline
			success_text = {
				text = anomaly.6705.desc.L
				owner = { has_country_flag = encountered_first_lgate }
			}
			success_text = {
				text = anomaly.6705.desc.noL
				owner = { NOT = { has_country_flag = encountered_first_lgate } }
			}
			text = anomaly.6705.desc.end
		}
	}
	picture = GFX_evt_gray_goo
	show_sound = event_mystic_reveal
	is_triggered_only = yes
	option =  {
		allow = { owner = { has_technology = tech_self_aware_logic } }
		name = anomaly.6705.a
		owner = { generate_lcluster_clue = yes }
		enable_special_project = {
			name = TAME_THE_SWARM
			location = event_target:nanite_swarm_planet
			owner = root
		}
	}
	option =  {
		name = anomaly.6705.b
		owner = { generate_lcluster_clue = yes }
		custom_tooltip = anomaly.6705.b.tooltip
		owner = {
			switch = {
				trigger = has_technology
				tech_self_aware_logic = {
					add_monthly_resource_mult = {
						resource = physics_research
						value = @tier2researchreward
						min = @tier2researchmin
						max = @tier2researchmax
					}
				}
				tech_administrative_ai = {
					add_tech_option_or_research_effect = {
   						TECH = tech_self_aware_logic
   						PROGRESS = 0.7
   						CATEGORY = physics_research
					}
				}
				# no AI option
				tech_flash_learning = {
					add_tech_option_or_research_effect = {
   						TECH = tech_self_aware_logic
   						PROGRESS = 0.7
   						CATEGORY = physics_research
					}
				}
				default = {
					if = {
						limit = { NOT = { has_policy_flag = ai_outlawed } }
						give_technology = { tech = tech_administrative_ai }
					}
					else = {
						give_technology = { tech = tech_flash_learning }
					}
				}
			}
			set_country_flag = studied_nanite_swarm
		}
	}
	option =  {
		name = anomaly.6705.c
		owner = { generate_lcluster_clue = yes }
		enable_special_project = {
			name = DESTROY_SWARM
			location = event_target:nanite_swarm_planet
			owner = root
		}
	}
}

# Modified:
# * use triggers
# * organic zealots get the same message as spiritualists
# * any branch offices in the recipient owned by the synthetic country are closed
# root = country (notified)
# from = country (synthetic)
country_event = {
	id = utopia.2555
	title = utopia.2550.name
	desc = {
		text = utopia.2555.1.desc
		trigger = {
			is_spiritualist = no
			NOT = { has_valid_civic = civic_organic_zealots }
		}
	}
	desc = {
		text = utopia.2555.2.desc
		trigger = {
			OR = {
				is_spiritualist = yes
				has_valid_civic = civic_organic_zealots
			}
		}
	}
	picture = GFX_evt_cybernetics
	show_sound = event_synthetic_evolution
	is_triggered_only = yes
	option = {
		name = utopia.2555.a
		trigger = {
			is_spiritualist = no
			NOT = { has_valid_civic = civic_organic_zealots }
		}
	}
	option = {
		name = utopia.2555.b
		trigger = {
			OR = {
				is_spiritualist = yes
				has_valid_civic = civic_organic_zealots
			}
		}
	}
	after = {
		if = {
			limit = {
				from = { has_corporate_government = yes }
				any_owned_planet = { has_branch_office = from }
				has_valid_civic = civic_organic_zealots
			}
			every_owned_planet = {
				limit = { has_branch_office = from }
				close_branch_office = yes
				owner = { add_resource = { energy = 1000 } }
			}
			from = {
				country_event = {
					id = civic_organic_zealots.2555
				}
			}
		}
		if = {
			limit = { has_secret_fealty_with = from }
			remove_secret_fealty = from
		}
		end_all_treaties_with = from
	}
}

# Modified:
# * use triggers
# * organic zealots get the same message as countries already at war with the synthetic empire
# root = country (notified)
# from = country (synthetic)
country_event = {
	id = utopia.2556
	title = TRANSMISSION
	desc = "utopia.2556.desc"
	diplomatic = yes
	is_triggered_only = yes
	picture_event_data = {
		portrait = from
		room = from.ruler
	}
	option = {
		name = utopia.2556.a
		trigger = {
			is_materialist = yes
			NOT = { is_at_war_with = from }
		}
	}
	option = {
		name = utopia.2556.b
		trigger = {
			is_spiritualist = yes
			NOR = {
				is_at_war_with = from
				has_valid_civic = civic_organic_zealots
			}
		}
	}
	option = {
		name = utopia.2556.c
		trigger = {
			OR = {
				is_at_war_with = from
				has_valid_civic = civic_organic_zealots
			}
		}
	}
	option = {
		name = utopia.2556.d
		trigger = {
			is_materialist = no
			is_spiritualist = no
			NOR = {
				is_at_war_with = from
				has_valid_civic = civic_organic_zealots
			}
		}
	}
}