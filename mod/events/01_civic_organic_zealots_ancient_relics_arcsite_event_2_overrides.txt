namespace = ancrel

### Robot Debris ###

# Stage 1 - Two Sides
# Modified:
# * alternate description for organic zealots
# * alternate option text for organic zealots
fleet_event = {
	id = ancrel.6250
	title = "ancrel.6250.name"
	desc = {
		text = "ancrel.6250.desc"
		trigger = { owner = { NOT = { has_civic = civic_organic_zealots } } }
	}
	desc = {
		text = "ancrel.6250.desc.organic_zealots"
		trigger = { owner = { has_civic = civic_organic_zealots } }
	}
	picture = GFX_evt_space_walk
	show_sound = event_metal_fatigue
	archaeology = yes
	is_triggered_only = yes
	immediate = {
		from = { set_site_progress_locked = yes }
	}
	after = {
		from = { set_site_progress_locked = no }
	}
	option = {
		name = {
			text = CURIOUS
			trigger = { owner = { NOT = { has_civic = civic_organic_zealots } } }
		}
		name = {
			text = DISTURBING
			trigger = { owner = { has_civic = civic_organic_zealots } }
		}
		small_artifact_reward = yes
	}
}

# Stage 2 - The Battle
# Modified:
# * alternate description for organic zealots
# * alternate option text for organic zealots
fleet_event = {
	id = ancrel.6255
	title = "ancrel.6255.name"
	desc = {
		text = "ancrel.6255.desc"
		trigger = { owner = { NOT = { has_civic = civic_organic_zealots } } }
	}
	desc = {
		text = "ancrel.6255.desc.organic_zealots"
		trigger = { owner = { has_civic = civic_organic_zealots } }
	}
	picture = GFX_evt_ground_combat
	show_sound = event_ground_battle
	archaeology = yes
	is_triggered_only = yes
	immediate = {
		from = { set_site_progress_locked = yes }
	}
	after = {
		from = { set_site_progress_locked = no }
	}
	option = {
		name = {
			text = CURIOUS
			trigger = { owner = { NOT = { has_civic = civic_organic_zealots } } }
		}
		name = {
			text = DISTURBING
			trigger = { owner = { has_civic = civic_organic_zealots } }
		}
		small_artifact_reward = yes
	}
}

# Stage 3 - The Treaty
# Modified:
# * alternate description for organic zealots
# * alternate option text for organic zealots
fleet_event = {
	id = ancrel.6260
	title = "ancrel.6260.name"
	desc = {
		text = "ancrel.6260.desc"
		trigger = { owner = { NOT = { has_civic = civic_organic_zealots } } }
	}
	desc = {
		text = "ancrel.6260.desc.organic_zealots"
		trigger = { owner = { has_civic = civic_organic_zealots } }
	}
	picture = GFX_evt_barren_dig_site
	show_sound = event_finding_loot
	archaeology = yes
	is_triggered_only = yes
	immediate = {
		from = { set_site_progress_locked = yes }
	}
	after = {
		from = { set_site_progress_locked = no }
	}
	option = {
		name = {
			text = CURIOUS
			trigger = { owner = { NOT = { has_civic = civic_organic_zealots } } }
		}
		name = {
			text = DISTURBING
			trigger = { owner = { has_civic = civic_organic_zealots } }
		}
		medium_artifact_reward = yes
		owner = {
			add_monthly_resource_mult = {
				resource = engineering_research
				value = @tier5researchreward
				min = @tier5researchmin
				max = @tier5researchmax
			}
		}
	}
}

### Surveillance Supercomputer ###

# Stage 1
# Modified:
# * alternate description for organic zealots
# * original option not shown for organic zealots
# * custom option for organic zealots
fleet_event = {
	id = ancrel.12070
	title = "ancrel.12070.name"
	desc = {
		text = "ancrel.12070.desc"
		trigger = { owner = { NOT = { has_civic = civic_organic_zealots } } }
	}
	desc = {
		text = "ancrel.12070.desc.organic_zealots"
		trigger = { owner = { has_civic = civic_organic_zealots } }
	}
	picture = GFX_evt_busy_spaceport
	show_sound = event_ghost_town
	location = from
	archaeology = yes
	is_triggered_only = yes
	immediate = {
		from = { set_site_progress_locked = yes }
	}
	option = {
		name = INTERESTING
		trigger = { owner = { NOT = { has_civic = civic_organic_zealots } } }
		small_artifact_reward = yes
		from = { set_site_progress_locked = no }
	}
	option = { # create the machines for purging
		name = "ancrel.12070.b.organic_zealots"
		custom_tooltip = "ancrel.12070.b.tooltip.organic_zealots"
		trigger = { owner = { has_civic = civic_organic_zealots } }
		hidden_effect = {
			from = {
				finish_site = no # no = do not trigger any stage completed
				set_site_progress_locked = yes # re-lock it
				planet = {
					set_planet_flag = site_observation_terminal_organic_zealots_purge
					change_pc = pc_machine
					set_owner = root.owner
					create_species = {
						class = MACHINE
						name = NAME_Surveillance_Bots
						portrait = random
						traits = {
							trait = trait_machine_unit
							trait = trait_robot_logic_engines
							trait = trait_robot_double_jointed
							trait = trait_robot_enhanced_memory
							trait = trait_robot_durable
							trait = trait_robot_custom_made
							trait = trait_robot_repurposed_hardware
						}
						effect = {
							save_event_target_as = new_robots
						}
					}
					add_building = building_machine_major_capital
					add_building = building_machine_assembly_complex
					while = {
						count = 10
						add_district = district_nexus
					}
					while = {
						count = 5
						add_district = district_industrial
						add_district = district_generator_uncapped
						add_district = district_mining_uncapped
					}
					while = {
						count = 80
						create_pop = { species = event_target:new_robots }
					}
				}
			}
			owner = {
				random = {
					chance = 50
					country_event = {
						id = ancrel.12095
						days = 30
					}
				}
			}
		}
	}
}

# Stage 5
# Modified:
# * allow synthetic/machine empires to select option c (they can't edit the relevant Robots Allowed policy!)
# * add trait_machine_unit to the species created by option e, otherwise they aren't recognized as machines by most game code
# * empire created by option e has specific civics (so as to not create homicidal vassals for non-machine empires, or servitor/assimilators without secondary Pops)
fleet_event = {
	id = ancrel.12090
	title = ancrel.12090.name
	desc = ancrel.12090.desc
	picture = GFX_evt_ai_planet
	show_sound = event_mystic_reveal
	location = from
	archaeology = yes
	is_triggered_only = yes
	immediate = {
		from = { set_site_progress_locked = yes }
	}
	after = {
		from = { set_site_progress_locked = no }
		large_artifact_reward = yes
	}
	option = {
		name = "ancrel.12090.A"
		trigger = { owner = { is_machine_empire = yes } }
		from.planet = {
			change_pc = pc_machine
			hidden_effect = {
				set_owner = root.owner
				create_species = {
					class = MACHINE
					name = NAME_Surveillance_Bots
					portrait = random
					traits = {
						trait = trait_machine_unit
						trait = trait_robot_logic_engines
						trait = trait_robot_double_jointed
						trait = trait_robot_enhanced_memory
						trait = trait_robot_durable
						trait = trait_robot_custom_made
						trait = trait_robot_repurposed_hardware
					}
					effect = {
						save_event_target_as = new_robots
					}
				}
				add_building = building_machine_major_capital
				add_building = building_machine_assembly_complex
				while = {
					count = 10
					add_district = district_nexus
				}
				while = {
					count = 5
					add_district = district_industrial
					add_district = district_generator_uncapped
					add_district = district_mining_uncapped
				}
				while = {
					count = 80
					create_pop = { species = event_target:new_robots }
				}
			}
		}
		hidden_effect = {
			owner = {
				random = {
					chance = 50
					country_event = {
						id = ancrel.12095
						days = 30
					}
				}
			}
		}
	}
	option = {
		name = "ancrel.12090.B"
		solar_system = {
			spawn_megastructure = {
				type = spy_orb_restored
				planet = from.planet
				graphical_culture = root.owner
			}
		}
	}
	option = {
		name = "ancrel.12090.C"
		custom_tooltip = "ancrel.12090.C.tooltip"
		allow = {
			owner = {
				OR = {
					is_synthetic_empire = yes
					has_policy_flag = robots_allowed
				}
			}
		}
		hidden_effect = {
			if = {
				limit = { owner = { is_machine_empire = yes } }
				create_species = {
					class = MACHINE
					name = NAME_Surveillance_Bots
					portrait = random
					traits = {
						trait = trait_machine_unit
						trait = trait_robot_logic_engines
						trait = trait_robot_double_jointed
						trait = trait_robot_enhanced_memory
						trait = trait_robot_durable
						trait = trait_robot_custom_made
						trait = trait_robot_repurposed_hardware
					}
					effect = {
						save_event_target_as = new_robots
					}
				}
			}
			else = {
				create_species = {
					class = ROBOT
					name = NAME_Surveillance_Bots
					portrait = random
					traits = {
						trait = trait_mechanical
						trait = trait_robot_logic_engines
						trait = trait_robot_double_jointed
						trait = trait_robot_enhanced_memory
						trait = trait_robot_durable
						trait = trait_robot_custom_made
						trait = trait_robot_repurposed_hardware
					}
					effect = {
						save_event_target_as = new_robots
					}
				}
			}
			owner = {
				while = {
					count = 80
					random_owned_planet = {
						create_pop = { species = event_target:new_robots }
						weights = {
							base = 10
							modifier = {
								factor = 0.5
								free_housing <= 0
								num_free_districts = {
									type = any
									value <= 1
								}
							}
						}
					}
				}
			}
		}
		hidden_effect = {
			owner = {
				random = {
					chance = 50
					country_event = {
						id = ancrel.12095
						days = 30
					}
				}
			}
		}
	}
	option = {
		name = "ancrel.12090.D"
		trigger = { owner = { is_spiritualist = yes } }
		from.planet = { add_deposit = d_alloys_25 }
		hidden_effect = {
			owner = {
				random = {
					chance = 50
					country_event = {
						id = ancrel.12095
						days = 30
					}
				}
			}
		}
	}
	option = {
		name = "ancrel.12090.E"
		custom_tooltip = "ancrel.12090.E.tooltip"
		allow = { owner = { is_spiritualist = no } }
		hidden_effect = {
			from.planet = {
				change_pc = pc_machine
				create_species = {
					class = MACHINE
					name = NAME_Surveillance_Bots
					portrait = random
					traits = {
						trait = trait_machine_unit
						trait = trait_robot_logic_engines
						trait = trait_robot_double_jointed
						trait = trait_robot_enhanced_memory
						trait = trait_robot_durable
						trait = trait_robot_custom_made
						trait = trait_robot_repurposed_hardware
					}
					effect = {
						save_event_target_as = new_robots
					}
				}
				create_country = {
					type = default
					name = NAME_Repurposed_Surveillance_Network
					species = event_target:new_robots
					ethos = {
						ethic = ethic_gestalt_consciousness
					}
					authority = auth_machine_intelligence
					civics = {
						civic = civic_machine_built_to_last
						civic = civic_machine_maintenance_protocols
					}
					effect = {
						prev.solar_system.starbase = { set_owner = prev }
						give_starting_resources_effect = yes
						add_resource = { unity = 1000000 }
						copy_techs_from = { target = root.owner }
						set_subject_of = { who = root.owner }
					}
				}
				set_owner = last_created_country
				set_capital = yes
				add_building = building_machine_major_capital
				add_building = building_machine_assembly_complex
				while = {
					count = 10
					add_district = district_nexus
				}
				while = {
					count = 5
					add_district = district_industrial
					add_district = district_generator_uncapped
					add_district = district_mining_uncapped
				}
				while = {
					count = 80
					create_pop = { species = event_target:new_robots }
				}
				solar_system = {
					if = {
						limit = {
							NOR = {
								has_megastructure = gateway_0
								has_megastructure = gateway_final
							}
						}
						spawn_megastructure = { # a bit weird, but otherwise they will probably be trapped here forever
							type = gateway_ruined
							random_pos = yes
							orbit_angle = 360
						}
					}
				}
			}
			owner = {
				random = {
					chance = 50
					country_event = {
						id = ancrel.12095
						days = 30
					}
				}
			}
		}
	}
}